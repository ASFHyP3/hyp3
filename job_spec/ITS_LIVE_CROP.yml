ITS_LIVE_CROP:
  required_parameters:
    - granule_uri
  parameters:
    granule_uri:
      api_schema:
        description: S3 URI for an ITS_LIVE velocity granule to generate metadata for
        type: string
        pattern: '^s3:\/\/.*\.nc$'
    publish_bucket:
      api_schema:
        description: Publish the resulting product files to the ITS_LIVE AWS Open Data (or test) S3 Bucket
        type: string
        nullable: true
        enum:
          - null
          - "its-live-data"
          - "its-live-data-test"
        default: null
    stac_items_endpoint:
      api_schema:
        description: STAC items endpoint URL for the collection you want to add items to
        type: string
        nullable: true
        format: uri
        default: null
    stac_exists_ok:
      api_schema:
        description: Allows updating existing STAC items
        type: boolean
        default: true
  cost_profiles:
    DEFAULT:
      cost: 1.0
  validators: []
  steps:
    - name: ''
      image: ghcr.io/asfhyp3/hyp3-autorift
      command:
        - ++process
        - crop_netcdf_product
        - Ref::granule_uri
        - --bucket
        - '!Ref Bucket'
        - --bucket-prefix
        - Ref::job_id
        - --publish-bucket
        - Ref::publish_bucket
      timeout: 10800
      compute_environment: Default
      vcpu: 1
      memory: 7875
      secrets:
        - PUBLISH_ACCESS_KEY_ID
        - PUBLISH_SECRET_ACCESS_KEY
    - name: METADATA
      image: ghcr.io/asfhyp3/itslive-metadata
      command:
        - ++plugin
        - meta
        - --granule-uri
        - Ref::granule_uri
        - --bucket
        - '!Ref Bucket'
        - --bucket-prefix
        - Ref::job_id
        - --publish-bucket
        - Ref::publish_bucket
        - --stac-items-endpoint
        - Ref::stac_items_endpoint
        - --stac-exists-ok
        - Ref::stac_exists_ok
      timeout: 10800
      compute_environment: ItsLiveMeta
      vcpu: 1
      memory: 7875
      secrets:
        - STAC_API_TOKEN
        - PUBLISH_ACCESS_KEY_ID
        - PUBLISH_SECRET_ACCESS_KEY
