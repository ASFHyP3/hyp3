ITS_LIVE_META_BULK:
  required_parameters:
    - granules_parquet
  parameters:
    granules_parquet:
      api_schema:
        description: S3 URI for an ITS_LIVE velocity granule to generate metadata for
        type: string
        pattern: '^s3:\/\/.*\.parquet$'
    start_idx:
      api_schema:
        description:  Start index (inclusive) of the contiguous subset of granules in granules_parquet to generate metadata for
        type: integer
        minimum: 0
        default: 0
    stop_idx:
      api_schema:
        description: Stop index (exclusive) of the contiguous subset of granules in granules_parquet to generate metadata for
        type: integer
        nullable: true
        minimum: 1
        default: null
    publish_bucket:
      api_schema:
        description: Publish the resulting metadata files to the ITS_LIVE AWS Open Data (or test) S3 Bucket
        type: string
        nullable: true
        enum:
          - null
          - "its-live-data"
          - "its-live-data-test"
        default: null
  cost_profiles:
    DEFAULT:
      cost: 1.0
  validators: []
  steps:
    - name: ''
      image: ghcr.io/asfhyp3/hyp3-autorift
      image_tag: "0.26.2.dev12_g202d2aa"
      command:
        - ++process
        - bulk_crop_netcdf_product
        - --granules-parquet
        - Ref::granules_parquet
        - --start-idx
        - Ref::start_idx
        - --stop-idx
        - Ref::stop_idx
        - --bucket
        - '!Ref Bucket'
        - --bucket-prefix
        - Ref::job_id
        - --publish-bucket
        - Ref::publish_bucket
      timeout: 21600
      compute_environment: ItsLiveAutoRIFT
      vcpu: 1
      memory: 7875
      secrets:
        - PUBLISH_ACCESS_KEY_ID
        - PUBLISH_SECRET_ACCESS_KEY
    - name: METADATA
      image: ghcr.io/asfhyp3/itslive-metadata
      image_tag: "0.6.1.dev11_ga449bc"
      command:
        - ++plugin
        - bulk_meta
        - --granules-parquet
        - Ref::granules_parquet
        - --start-idx
        - Ref::start_idx
        - --stop-idx
        - Ref::stop_idx
        - --bucket
        - '!Ref Bucket'
        - --bucket-prefix
        - Ref::job_id
        - --publish-bucket
        - Ref::publish_bucket
      timeout: 21600
      compute_environment: ItsLiveMeta
      vcpu: 1
      memory: 7875
      secrets:
        - PUBLISH_ACCESS_KEY_ID
        - PUBLISH_SECRET_ACCESS_KEY
